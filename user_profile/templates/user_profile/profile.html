{% extends "hoosRiding/base.html" %}
{% load static %}
{% load request_ride %}
{% load split_words %}

{% block content %}

<script src="https://code.jquery.com/jquery-3.1.1.min.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css">
<script src="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.js"></script>

<!-- Style Sheet Import -->
<link rel="stylesheet" type="text/css" href="{% static 'user_profile/user_profile.css' %}">

<h1>Welcome, {{ user.first_name }}! </h1>

<div class="profile">
<!--    Left Side       -->
    <div class="left">

        <img class="avatar" src="https://www.w3schools.com/howto/img_avatar2.png">
        <br/><br/>
        <div class="star-rank">
<!--            use for loop to loop thru stars this person has -->
            <img class="star" src="https://yakimaymca.org/wp-content/uploads/2018/11/Star.png">
            <img class="star" src="https://yakimaymca.org/wp-content/uploads/2018/11/Star.png">
            <img class="star" src="https://yakimaymca.org/wp-content/uploads/2018/11/Star.png">
            <img class="star" src="https://yakimaymca.org/wp-content/uploads/2018/11/Star.png">
            <img class="star" src="https://yakimaymca.org/wp-content/uploads/2018/11/Star.png">

<!--            <img class="star" src="https://p7.hiclipart.com/preview/191/610/574/five-pointed-star-outline-symbol-clip-art-star.jpg">-->
        </div>
        <br/>
<!--        Display Profile -->
        <div>
            <b>Name: </b>
            {{ user.first_name }} {{ user.last_name }}
            <br/>
            <b>Email: </b>
            {{ user.email }}
            <br/>
            <b>Cell: </b>
            {% if current_user.cellphone %}
                {{ current_user.cellphone }}
            {% else %}
                No phone number provided
            {% endif %}
            <br/>
            <b>Car:</b>
            {% if current_user.car_type %}
                {{ current_user.car_type }}
            {% else %}
                No car type provided
            {% endif %}
            <br/>
            <b>License Plate: </b>
            {% if current_user.license_plate  %}
                {{ current_user.license_plate }}
            {% else %}
                No license plate provided
            {% endif %}
            <br/>
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editProfileModal">Edit Profile</button>

            <!-- Edit Profile Modal -->
            <div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 class="modal-title" id="exampleModalLongTitle">Edit Profile Information</h3>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form action="" method="get">
                                {% csrf_token %}
                                <label for="cell"><b>Cell Number: </b></label>
                                <input id="cell" type="text" name="cellphone" placeholder="{{ current_user.cellphone }}" value="{{ current_user.cellphone  }}">
                                <br/>
                                <label for="car_type"><b>Car Type: </b></label>
                                <input id="car_type" type="text" name="car_type" placeholder="{{ current_user.car_type }}" value="{{  current_user.car_type }}">
                                <br/>
                                <label for="license_plate"><b>License Plate:</b></label>
                                <input id="license_plate" type="text" name="license_plate" placeholder="{{ current_user.license_plate }}" value="{{ current_user.license_plate }}">
                                <br/>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                                    <input type="submit" value="Save" class="btn btn-primary">
                                 </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
<!--    Right Side      -->
    <div class="right">

        {% if viewingPassenger %}

        <div class="ui fluid two item menu">
          <a class="item active">Passenger</a>
          <a href="{% url 'switchToDriverView' %}" class="item">Driver</a>
        </div>

        {% for Posting,status in allRides.items %}
            <div class="ui fluid raised centered card">
              <div class="content">
                  <table style="width:100%;height:100%">
                      <td><h3>{{ Posting.location_from }} to {{ Posting.location_to }}<i class="car icon"></i></h3></td>
                      <td style="text-align: right;">
                          {% calculatetime Posting.date %}
                      </td>
                  </table>
                <div class="meta">{{ Posting.riding_date}} </div>
                <div class="description">
                  <p>Asking price: ${{ Posting.price }}</p>
                    <p>Spots left: {{ Posting.num_passengers }}</p>
                </div>
              </div>


                <div class="extra content">
                    Request Status:
                    {% if status == "accepted" %}
                     <p style="color:green; display: inline;">accepted</p><i class="green check icon"></i>
                    {% elif status == "pending" %}
                    pending<i class="exclamation circle icon"></i>
                    {% else %}
                    <p style="color:red; display: inline;">declined</p><i class="red ban icon"></i>
                    {% endif %}
                  </div>

                <!--Dropdown of extra info-->
                <div class="ui styled accordion">
                    <div class="title">
                        <i class="dropdown icon"></i>
                        Details
                </div>
                    <div class="content">
                <p class="transition ">
                    Riders on trip
                    {% with Posting.riders_riding|split:"," as request_list %}
                        {% if request_list %}
                            <ul>
                            {% for rider in request_list %}
                                <li>{{rider}}</li>

                            {% endfor %}
                            </ul>
                        {% else %}
                        <p>None</p>
                        {% endif %}

                    {% endwith %}

                    <br>
                    <iframe
                          width="500"
                          height="300"
                          frameborder="0" style="border:0"
                          src="https://www.google.com/maps/embed/v1/directions?key=AIzaSyAcJ9C8vhZqeSsNbZ8hxGGeR8F7s351_8Y&origin={{Posting.location_from}}&destination={{Posting.location_to}}" allowfullscreen>
                        </iframe>
                </p>
                    </div>
                </div>

            </div>

        {% endfor %}


        {% else %}

            <!--view if looking at rides hosting-->
            <div class="ui fluid two item menu">
              <a class="item" href="{% url 'switchToPassengerView' %}">Passenger</a>
              <a class="item active">Driver</a>
            </div>


            <!--The list of cards-->
            {% for Posting in ridesDriving %}
            <div class="ui fluid raised centered card">
              <div class="content">
                  <table style="width:100%;height:100%">
                      <td><h3>{{ Posting.location_from }} to {{ Posting.location_to }}<i class="car icon"></i></h3></td>
                      <td style="text-align: right;">
                          {% calculatetime Posting.date %}
                      </td>
                  </table>
                <div class="meta">{{ Posting.riding_date}} </div>
                <div class="description">
                  <p>Asking price: ${{ Posting.price }}</p>
                    <p>Spots left: {{ Posting.num_passengers }}</p>
                </div>
              </div>

                <!--If any requests for rides, appear here-->
                {% with Posting.riders_requested|split:"," as request_list %}
                    {% if request_list %}
                        <div class="extra content">
                            <h5>New Requests</h5>
                        {% for rider in request_list %}
                            <table style="width:100%">
                                <td><h6>{{rider}}</h6></td>
                                <td style="text-align: right;">
                                    <a href="{% url 'respondToDriverRequest' %}?id={{Posting.posting_id}}&rider={{rider}}&status=accept"><button class="positive ui button">Accept</button></a>
                                    <a href="{% url 'respondToDriverRequest' %}?id={{Posting.posting_id}}&rider={{rider}}&status=decline"><button class="negative ui button">Decline</button></a>
                                </td>
                            </table>
                        {% endfor %}
                        </div>
                    {% endif %}
                {% endwith %}

                <!--Dropdown of extra info-->
                <div class="ui styled accordion">
                    <div class="title">
                        <i class="dropdown icon"></i>
                        Details
                </div>
                    <div class="content">
                <p class="transition ">
                    Riders on trip
                    {% with Posting.riders_riding|split:"," as request_list %}
                        {% if request_list %}
                            <ul>
                            {% for rider in request_list %}
                                <li>{{rider}}</li>

                            {% endfor %}
                            </ul>
                        {% else %}
                        <p>None</p>
                        {% endif %}

                    {% endwith %}

                    <br>
                    <iframe
                          width="500"
                          height="300"
                          frameborder="0" style="border:0"
                          src="https://www.google.com/maps/embed/v1/directions?key=AIzaSyAcJ9C8vhZqeSsNbZ8hxGGeR8F7s351_8Y&origin={{Posting.location_from}}&destination={{Posting.location_to}}" allowfullscreen>
                        </iframe>
                </p>
                    </div>
                </div>

            </div>
            {%endfor%}


        {% endif %}




    </div>

</div>

<script>
    $('.ui.accordion').accordion();
</script>

{% endblock %}
